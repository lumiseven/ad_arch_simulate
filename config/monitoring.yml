# ç³»ç»Ÿç›‘æ§é…ç½®æ–‡ä»¶
# å®šä¹‰ç›‘æ§æŒ‡æ ‡ã€å‘Šè­¦è§„åˆ™å’Œå¥åº·æ£€æŸ¥é…ç½®

# æœåŠ¡ç›‘æ§é…ç½®
services:
  ad-management:
    port: 8001
    health_endpoint: "/health"
    metrics_endpoint: "/metrics"
    timeout: 5
    check_interval: 30
    
  dsp:
    port: 8002
    health_endpoint: "/health"
    metrics_endpoint: "/metrics"
    timeout: 5
    check_interval: 30
    
  ssp:
    port: 8003
    health_endpoint: "/health"
    metrics_endpoint: "/metrics"
    timeout: 5
    check_interval: 30
    
  ad-exchange:
    port: 8004
    health_endpoint: "/health"
    metrics_endpoint: "/metrics"
    timeout: 5
    check_interval: 30
    
  dmp:
    port: 8005
    health_endpoint: "/health"
    metrics_endpoint: "/metrics"
    timeout: 5
    check_interval: 30

# å¥åº·æ£€æŸ¥é…ç½®
health_checks:
  # å“åº”æ—¶é—´é˜ˆå€¼ (æ¯«ç§’)
  response_time_thresholds:
    healthy: 100
    degraded: 500
    unhealthy: 1000
    
  # è¿ç»­å¤±è´¥æ¬¡æ•°é˜ˆå€¼
  failure_thresholds:
    warning: 3
    critical: 5
    
  # æ£€æŸ¥é—´éš” (ç§’)
  check_intervals:
    normal: 30
    degraded: 15
    critical: 5

# æ€§èƒ½ç›‘æ§æŒ‡æ ‡
metrics:
  # RTB æ€§èƒ½æŒ‡æ ‡
  rtb:
    # RTB æµç¨‹æ€»æ—¶é—´é˜ˆå€¼ (æ¯«ç§’)
    total_time_thresholds:
      good: 80
      acceptable: 100
      poor: 150
      
    # DSP å“åº”æ—¶é—´é˜ˆå€¼ (æ¯«ç§’)
    dsp_response_thresholds:
      good: 30
      acceptable: 50
      poor: 80
      
    # ç«ä»·æˆåŠŸç‡é˜ˆå€¼
    bid_success_rate_thresholds:
      good: 0.8
      acceptable: 0.6
      poor: 0.4
      
  # æ•°æ®åº“æ€§èƒ½æŒ‡æ ‡
  database:
    # æŸ¥è¯¢å“åº”æ—¶é—´é˜ˆå€¼ (æ¯«ç§’)
    query_time_thresholds:
      good: 50
      acceptable: 100
      poor: 200
      
    # è¿æ¥æ± ä½¿ç”¨ç‡é˜ˆå€¼
    connection_pool_thresholds:
      good: 0.7
      acceptable: 0.85
      critical: 0.95
      
  # ç³»ç»Ÿèµ„æºæŒ‡æ ‡
  system:
    # CPU ä½¿ç”¨ç‡é˜ˆå€¼
    cpu_thresholds:
      good: 0.6
      warning: 0.8
      critical: 0.9
      
    # å†…å­˜ä½¿ç”¨ç‡é˜ˆå€¼
    memory_thresholds:
      good: 0.7
      warning: 0.85
      critical: 0.95
      
    # ç£ç›˜ä½¿ç”¨ç‡é˜ˆå€¼
    disk_thresholds:
      good: 0.7
      warning: 0.85
      critical: 0.95

# å‘Šè­¦é…ç½®
alerts:
  # å‘Šè­¦çº§åˆ«
  levels:
    - info
    - warning
    - error
    - critical
    
  # å‘Šè­¦è§„åˆ™
  rules:
    # æœåŠ¡ä¸å¯ç”¨å‘Šè­¦
    - name: "service_unavailable"
      condition: "service_status == 'unhealthy'"
      level: "critical"
      message: "Service {service_name} is unavailable"
      cooldown: 300  # 5åˆ†é’Ÿå†·å´æœŸ
      
    # å“åº”æ—¶é—´è¿‡æ…¢å‘Šè­¦
    - name: "slow_response"
      condition: "response_time > degraded_threshold"
      level: "warning"
      message: "Service {service_name} response time is {response_time}ms"
      cooldown: 180  # 3åˆ†é’Ÿå†·å´æœŸ
      
    # RTB æµç¨‹è¶…æ—¶å‘Šè­¦
    - name: "rtb_timeout"
      condition: "rtb_duration > 100"
      level: "error"
      message: "RTB workflow timeout: {rtb_duration}ms"
      cooldown: 60   # 1åˆ†é’Ÿå†·å´æœŸ
      
    # æ•°æ®åº“è¿æ¥å‘Šè­¦
    - name: "database_connection"
      condition: "database_status == 'disconnected'"
      level: "critical"
      message: "Database connection lost for service {service_name}"
      cooldown: 300  # 5åˆ†é’Ÿå†·å´æœŸ
      
    # é«˜é”™è¯¯ç‡å‘Šè­¦
    - name: "high_error_rate"
      condition: "error_rate > 0.05"  # 5% é”™è¯¯ç‡
      level: "warning"
      message: "High error rate detected: {error_rate}%"
      cooldown: 300  # 5åˆ†é’Ÿå†·å´æœŸ

# æ—¥å¿—èšåˆé…ç½®
logging:
  # æ—¥å¿—çº§åˆ«
  levels:
    default: "INFO"
    services:
      ad-exchange: "DEBUG"  # RTB æµç¨‹éœ€è¦è¯¦ç»†æ—¥å¿—
      rtb: "DEBUG"
      
  # æ—¥å¿—è½®è½¬é…ç½®
  rotation:
    max_size: "10MB"
    backup_count: 5
    
  # æ—¥å¿—æ ¼å¼
  formats:
    console: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
    file: "%(asctime)s - %(name)s - %(levelname)s - %(filename)s:%(lineno)d - %(message)s"
    json: '{"timestamp": "%(asctime)s", "service": "%(name)s", "level": "%(levelname)s", "message": "%(message)s"}'
    
  # ç‰¹æ®Šæ—¥å¿—å¤„ç†
  special_loggers:
    rtb:
      format: "%(asctime)s - RTB - %(levelname)s - %(message)s"
      file: "logs/rtb.log"
      
    database:
      format: "%(asctime)s - DB - %(levelname)s - %(message)s"
      file: "logs/database.log"
      level: "WARNING"  # åªè®°å½•è­¦å‘Šå’Œé”™è¯¯

# æ•°æ®æ”¶é›†é…ç½®
data_collection:
  # æŒ‡æ ‡æ”¶é›†é—´éš” (ç§’)
  collection_interval: 10
  
  # æ•°æ®ä¿ç•™æœŸ (å¤©)
  retention_days: 30
  
  # èšåˆç»Ÿè®¡é—´éš”
  aggregation_intervals:
    - "1m"   # 1åˆ†é’Ÿ
    - "5m"   # 5åˆ†é’Ÿ
    - "1h"   # 1å°æ—¶
    - "1d"   # 1å¤©
    
  # æ”¶é›†çš„æŒ‡æ ‡ç±»å‹
  metrics_types:
    - "response_time"
    - "request_count"
    - "error_count"
    - "success_rate"
    - "rtb_duration"
    - "bid_success_rate"
    - "database_query_time"
    - "system_resources"

# æŠ¥è¡¨é…ç½®
reporting:
  # è‡ªåŠ¨æŠ¥è¡¨ç”Ÿæˆ
  auto_reports:
    daily:
      enabled: true
      time: "09:00"
      recipients: ["admin@example.com"]
      
    weekly:
      enabled: true
      day: "monday"
      time: "09:00"
      recipients: ["admin@example.com"]
      
  # æŠ¥è¡¨å†…å®¹
  report_content:
    - "system_health_summary"
    - "performance_metrics"
    - "error_analysis"
    - "rtb_statistics"
    - "top_campaigns"
    - "resource_usage"
    
  # æŠ¥è¡¨æ ¼å¼
  formats:
    - "html"
    - "json"

# ä»ªè¡¨æ¿é…ç½®
dashboard:
  # åˆ·æ–°é—´éš” (ç§’)
  refresh_interval: 30
  
  # æ˜¾ç¤ºçš„å›¾è¡¨
  charts:
    - name: "æœåŠ¡å¥åº·çŠ¶æ€"
      type: "status_grid"
      data_source: "health_checks"
      
    - name: "å“åº”æ—¶é—´è¶‹åŠ¿"
      type: "line_chart"
      data_source: "response_times"
      time_range: "1h"
      
    - name: "RTB æ€§èƒ½æŒ‡æ ‡"
      type: "gauge_chart"
      data_source: "rtb_metrics"
      
    - name: "é”™è¯¯ç‡ç»Ÿè®¡"
      type: "bar_chart"
      data_source: "error_rates"
      time_range: "24h"
      
    - name: "ç³»ç»Ÿèµ„æºä½¿ç”¨"
      type: "area_chart"
      data_source: "system_metrics"
      time_range: "1h"

# é€šçŸ¥é…ç½®
notifications:
  # é€šçŸ¥æ¸ é“
  channels:
    console:
      enabled: true
      levels: ["info", "warning", "error", "critical"]
      
    file:
      enabled: true
      file: "logs/alerts.log"
      levels: ["warning", "error", "critical"]
      
    email:
      enabled: false
      smtp_server: "smtp.example.com"
      smtp_port: 587
      username: "alerts@example.com"
      password: "password"
      recipients: ["admin@example.com"]
      levels: ["error", "critical"]
      
  # é€šçŸ¥æ¨¡æ¿
  templates:
    service_down: "ğŸš¨ æœåŠ¡å‘Šè­¦: {service_name} æœåŠ¡ä¸å¯ç”¨"
    slow_response: "âš ï¸ æ€§èƒ½å‘Šè­¦: {service_name} å“åº”æ—¶é—´è¿‡æ…¢ ({response_time}ms)"
    rtb_timeout: "âŒ RTB å‘Šè­¦: ç«ä»·æµç¨‹è¶…æ—¶ ({duration}ms)"
    database_error: "ğŸ’¾ æ•°æ®åº“å‘Šè­¦: {service_name} æ•°æ®åº“è¿æ¥å¼‚å¸¸"